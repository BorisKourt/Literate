#!/usr/bin/env julia

function name(path)
    basename(path[1:search(path, '.')[1]-1])
end

html = false
code = false

inputfiles = String[]
for arg in ARGS
	if arg == "-h"
		println("Usage: lit [-html] [-code] [file ...]")
		exit()
	elseif arg == "-html"
		html = true
	elseif arg == "-code"
		code = true
	else
		push!(inputfiles, arg)
	end
end

if !html && !code
	html = true
	code = true
end

gen = "$(dirname(Base.source_path()))/../gen"

if length(inputfiles) == 0
	if html
		include("$gen/weave.jl")
		weave(STDIN, STDOUT)
	end

	if code
		include("$gen/tangle.jl")
		tangle(STDIN)
	end
else
	if html
		include("$gen/weave.jl")
		for file in inputfiles
			inputstream = open(file)
			outputstream = open("$(name(file)).html", "w")
			weave(inputstream, outputstream)
			close(inputstream)
			close(outputstream)
		end
	end

	if code
		include("$gen/tangle.jl")
		for file in inputfiles
			inputstream = open(file)
			tangle(inputstream)
			close(inputstream)
		end
	end
end
